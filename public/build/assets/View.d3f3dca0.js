import{aN as O,m as j,M as P,d as x,K as Y,e as A,P as Z,r as l,o as d,c as F,b as f,a as t,i as r,t as B,g as a,k as y,F as H,j as ee,z as N,n as te,h as w,a4 as ne,p as M,N as G,a5 as ae,R as T,E as oe,a9 as re}from"./main.85eae20a.js";import{L as se}from"./LoadingIcon.5945157d.js";import{_ as ie}from"./InvoiceIndexDropdown.4ff906cb.js";import{_ as le}from"./SendInvoiceModal.744acfbe.js";import{_ as ce}from"./RecurringInvoiceIndexDropdown.11335af2.js";import"./mail-driver.d7b75d9a.js";const ue={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.4rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},de={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},me={class:"mb-6"},_e={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},ve={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},ge={class:"flex-2"},pe={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},fe={class:"flex-1 whitespace-nowrap right"},ye={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},be={key:0,class:"flex justify-center p-4 items-center"},Ie={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Be={__name:"RecurringInvoiceViewSidebar",setup(U){const n=O();j();const v=P(),s=x(!1),m=x(null),c=x(1),p=x(1),b=x(null),e=Y({orderBy:null,orderByField:null,searchText:null}),R=A(()=>e.orderBy==="asc"||e.orderBy==null);function k(o){return v.params.id==o}async function I(o,_=!1){if(s.value)return;let g={};e.searchText!==""&&e.searchText!==null&&e.searchText!==void 0&&(g.search=e.searchText),e.orderBy!==null&&e.orderBy!==void 0&&(g.orderBy=e.orderBy),e.orderByField!==null&&e.orderByField!==void 0&&(g.orderByField=e.orderByField),s.value=!0;let S=await n.fetchRecurringInvoices({page:o,...g});s.value=!1,m.value=m.value?m.value:[],m.value=[...m.value,...S.data.data],c.value=o||1,p.value=S.data.meta.last_page;let h=m.value.find(E=>E.id==v.params.id);_==!1&&!h&&c.value<p.value&&Object.keys(g).length===0&&I(++c.value),h&&setTimeout(()=>{_==!1&&V()},500)}function V(){const o=document.getElementById(`recurring-invoice-${v.params.id}`);o&&(o.scrollIntoView({behavior:"smooth"}),o.classList.add("shake"),$())}function $(){b.value.addEventListener("scroll",o=>{o.target.scrollTop>0&&o.target.scrollTop+o.target.clientHeight>o.target.scrollHeight-200&&c.value<p.value&&I(++c.value,!0)})}async function i(){m.value=[],I()}function L(){return e.orderBy==="asc"?(e.orderBy="desc",i(),!0):(e.orderBy="asc",i(),!0)}return I(),i=Z.exports.debounce(i,500),(o,_)=>{var z;const g=l("BaseIcon"),S=l("BaseInput"),h=l("BaseButton"),E=l("BaseRadio"),C=l("BaseInputGroup"),D=l("BaseDropdownItem"),q=l("BaseDropdown"),K=l("BaseText"),W=l("BaseRecurringInvoiceStatusBadge"),J=l("BaseFormatMoney"),Q=l("router-link");return d(),F("div",ue,[f("div",de,[f("div",me,[t(S,{modelValue:e.searchText,"onUpdate:modelValue":_[0]||(_[0]=u=>e.searchText=u),placeholder:o.$t("general.search"),type:"text",variant:"gray",onInput:_[1]||(_[1]=u=>i())},{right:r(()=>[t(g,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),f("div",_e,[t(q,{class:"ml-3",position:"bottom-start"},{activator:r(()=>[t(h,{size:"md",variant:"gray"},{default:r(()=>[t(g,{name:"FilterIcon",class:"h-5"})]),_:1})]),default:r(()=>[f("div",ve,B(o.$t("general.sort_by")),1),t(D,{class:"flex px-1 py-2 cursor-pointer"},{default:r(()=>[t(C,{class:"-mt-3 font-normal"},{default:r(()=>[t(E,{id:"filter_next_invoice_date",modelValue:e.orderByField,"onUpdate:modelValue":[_[2]||(_[2]=u=>e.orderByField=u),i],label:o.$t("recurring_invoices.next_invoice_date"),size:"sm",name:"filter",value:"next_invoice_at"},null,8,["modelValue","label"])]),_:1})]),_:1}),t(D,{class:"flex px-1 py-2 cursor-pointer"},{default:r(()=>[t(C,{class:"-mt-3 font-normal"},{default:r(()=>[t(E,{id:"filter_start_date",modelValue:e.orderByField,"onUpdate:modelValue":[_[3]||(_[3]=u=>e.orderByField=u),i],label:o.$t("recurring_invoices.starts_at"),value:"starts_at",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),t(h,{class:"ml-1",size:"md",variant:"gray",onClick:L},{default:r(()=>[a(R)?(d(),y(g,{key:0,name:"SortAscendingIcon",class:"h-5"})):(d(),y(g,{key:1,name:"SortDescendingIcon",class:"h-5"}))]),_:1})])]),f("div",{ref_key:"invoiceListSection",ref:b,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},[(d(!0),F(H,null,ee(m.value,(u,X)=>(d(),F("div",{key:X},[u?(d(),y(Q,{key:0,id:"recurring-invoice-"+u.id,to:`/admin/recurring-invoices/${u.id}/view`,class:te(["flex justify-between side-invoice p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":k(u.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:r(()=>[f("div",ge,[t(K,{text:u.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),f("div",pe,B(u.invoice_number),1),t(W,{status:u.status,class:"px-1 text-xs"},{default:r(()=>[N(B(u.status),1)]),_:2},1032,["status"])]),f("div",fe,[t(J,{class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900",amount:u.total,currency:u.customer.currency},null,8,["amount","currency"]),f("div",ye,B(u.formatted_starts_at),1)])]),_:2},1032,["id","to","class"])):w("",!0)]))),128)),s.value?(d(),F("div",be,[t(se,{class:"h-6 m-1 animate-spin text-primary-400"})])):w("",!0),!((z=m.value)!=null&&z.length)&&!s.value?(d(),F("p",Ie,B(o.$t("invoices.no_matching_invoices")),1)):w("",!0)],512)])}}},he={class:"relative table-container"},xe={__name:"Invoices",setup(U){const n=O(),v=x(null);x(null),ne("$utils");const{t:s}=j();x(null),M();const m=G(),c=A(()=>[{key:"invoice_date",label:s("invoices.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"invoice_number",label:s("invoices.invoice")},{key:"customer.name",label:s("invoices.customer")},{key:"status",label:s("invoices.status")},{key:"total",label:s("invoices.total")},{key:"actions",label:s("invoices.action"),tdClass:"text-right text-sm font-medium",thClass:"text-right",sortable:!1}]);function p(){return m.hasAbilities([T.DELETE_INVOICE,T.EDIT_INVOICE,T.VIEW_INVOICE,T.SEND_INVOICE])}function b(e){let R=n.newRecurringInvoice.invoices.findIndex(k=>k.id===e);n.newRecurringInvoice.invoices[R]&&(n.newRecurringInvoice.invoices[R].status="SENT")}return(e,R)=>{const k=l("router-link"),I=l("BaseFormatMoney"),V=l("BaseInvoiceStatusBadge"),$=l("BaseTable");return d(),F(H,null,[t(le,{onUpdate:b}),f("div",he,[t($,{ref_key:"table",ref:v,data:a(n).newRecurringInvoice.invoices,columns:a(c),loading:a(n).isFetchingViewData,"placeholder-count":5,class:"mt-5"},ae({"cell-invoice_number":r(({row:i})=>[t(k,{to:{path:`/admin/invoices/${i.data.id}/view`},class:"font-medium text-primary-500"},{default:r(()=>[N(B(i.data.invoice_number),1)]),_:2},1032,["to"])]),"cell-total":r(({row:i})=>[t(I,{amount:i.data.due_amount,currency:i.data.currency},null,8,["amount","currency"])]),"cell-status":r(({row:i})=>[t(V,{status:i.data.status,class:"px-3 py-1"},{default:r(()=>[N(B(i.data.status),1)]),_:2},1032,["status"])]),_:2},[p()?{name:"cell-actions",fn:r(({row:i})=>[t(ie,{row:i.data,table:v.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["data","columns","loading"])])],64)}}},we={__name:"RecurringInvoiceInfo",setup(U){const n=O(),v=P();let s=A(()=>n.isFetchingViewData);oe(v,()=>{v.params.id&&v.name==="recurring-invoices.view"&&m()},{immediate:!0});async function m(){await n.fetchRecurringInvoice(v.params.id)}return(c,p)=>{const b=l("BaseHeading"),e=l("BaseDescriptionListItem"),R=l("BaseDescriptionList"),k=l("BaseCard");return d(),y(k,{class:"mt-10"},{default:r(()=>[t(b,null,{default:r(()=>[N(B(c.$t("customers.basic_info")),1)]),_:1}),t(R,{class:"mt-5"},{default:r(()=>{var I,V,$,i,L,o,_,g,S,h,E,C,D;return[t(e,{label:c.$t("recurring_invoices.starts_at"),"content-loading":a(s),value:(I=a(n).newRecurringInvoice)==null?void 0:I.formatted_starts_at},null,8,["label","content-loading","value"]),t(e,{label:c.$t("recurring_invoices.next_invoice_date"),"content-loading":a(s),value:(V=a(n).newRecurringInvoice)==null?void 0:V.formatted_next_invoice_at},null,8,["label","content-loading","value"]),(($=a(n).newRecurringInvoice)==null?void 0:$.limit_date)&&((i=a(n).newRecurringInvoice)==null?void 0:i.limit_by)!=="NONE"?(d(),y(e,{key:0,label:c.$t("recurring_invoices.limit_date"),"content-loading":a(s),value:(L=a(n).newRecurringInvoice)==null?void 0:L.limit_date},null,8,["label","content-loading","value"])):w("",!0),((o=a(n).newRecurringInvoice)==null?void 0:o.limit_date)&&((_=a(n).newRecurringInvoice)==null?void 0:_.limit_by)!=="NONE"?(d(),y(e,{key:1,label:c.$t("recurring_invoices.limit_by"),"content-loading":a(s),value:(g=a(n).newRecurringInvoice)==null?void 0:g.limit_by},null,8,["label","content-loading","value"])):w("",!0),(S=a(n).newRecurringInvoice)!=null&&S.limit_count?(d(),y(e,{key:2,label:c.$t("recurring_invoices.limit_count"),value:(h=a(n).newRecurringInvoice)==null?void 0:h.limit_count,"content-loading":a(s)},null,8,["label","value","content-loading"])):w("",!0),(E=a(n).newRecurringInvoice)!=null&&E.selectedFrequency?(d(),y(e,{key:3,label:c.$t("recurring_invoices.frequency.title"),value:(D=(C=a(n).newRecurringInvoice)==null?void 0:C.selectedFrequency)==null?void 0:D.label,"content-loading":a(s)},null,8,["label","value","content-loading"])):w("",!0)]}),_:1}),t(b,{class:"mt-8"},{default:r(()=>[N(B(c.$t("invoices.title",2)),1)]),_:1}),t(xe)]),_:1})}}},Fe={__name:"View",setup(U){re();const n=O(),v=G();j(),M();const s=A(()=>{var c,p;return n.newRecurringInvoice?(p=(c=n.newRecurringInvoice)==null?void 0:c.customer)==null?void 0:p.name:""});function m(){return v.hasAbilities([T.DELETE_RECURRING_INVOICE,T.EDIT_RECURRING_INVOICE])}return(c,p)=>{const b=l("BasePageHeader"),e=l("BasePage");return d(),y(e,{class:"xl:pl-96"},{default:r(()=>[t(b,{title:a(s)},{actions:r(()=>[m()?(d(),y(ce,{key:0,row:a(n).newRecurringInvoice},null,8,["row"])):w("",!0)]),_:1},8,["title"]),t(Be),t(we)]),_:1})}}};export{Fe as default};
