import{ac as x,r as o,o as g,c as L,a,g as e,i as n,ay as Y,H as A,ah as O,m as J,d as S,M as K,p as Q,e as y,q as f,s as w,ak as W,ai as X,Y as Z,x as ee,E as te,k as E,h as C,b as B,t as I,n as ae,z as se,w as ie,F as ne}from"./main.85eae20a.js";import{_ as oe,a as le,b as re,c as me,d as de,e as ue,f as ce}from"./SalesTax.ca33b334.js";import{_ as ge}from"./CreateCustomFields.d92decaa.js";import{_ as pe}from"./ExchangeRateConverter.3e873475.js";import{_ as _e}from"./TaxTypeModal.8af63e3e.js";import"./DragIcon.b05ab1c2.js";import"./SelectNotePopup.bd13c791.js";import"./NoteModal.570a3dbe.js";import"./payment.91c0b052.js";import"./exchange-rate.5b431e00.js";const fe={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},ve={__name:"EstimateCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(s){const t=x();return(v,l)=>{const $=o("BaseCustomerSelectPopup"),r=o("BaseDatePicker"),u=o("BaseInputGroup"),c=o("BaseInput"),h=o("BaseInputGrid");return g(),L("div",fe,[a($,{modelValue:e(t).newEstimate.customer,"onUpdate:modelValue":l[0]||(l[0]=m=>e(t).newEstimate.customer=m),valid:s.v.customer_id,"content-loading":s.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),a(h,{class:"col-span-7"},{default:n(()=>[a(u,{label:v.$t("reports.estimates.estimate_date"),"content-loading":s.isLoading,required:"",error:s.v.estimate_date.$error&&s.v.estimate_date.$errors[0].$message},{default:n(()=>[a(r,{modelValue:e(t).newEstimate.estimate_date,"onUpdate:modelValue":l[1]||(l[1]=m=>e(t).newEstimate.estimate_date=m),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(u,{label:v.$t("estimates.expiry_date"),"content-loading":s.isLoading},{default:n(()=>[a(r,{modelValue:e(t).newEstimate.expiry_date,"onUpdate:modelValue":l[2]||(l[2]=m=>e(t).newEstimate.expiry_date=m),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(u,{label:v.$t("estimates.estimate_number"),"content-loading":s.isLoading,required:"",error:s.v.estimate_number.$error&&s.v.estimate_number.$errors[0].$message},{default:n(()=>[a(c,{modelValue:e(t).newEstimate.estimate_number,"onUpdate:modelValue":l[3]||(l[3]=m=>e(t).newEstimate.estimate_number=m),"content-loading":s.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(pe,{store:e(t),"store-prop":"newEstimate",v:s.v,"is-loading":s.isLoading,"is-edit":s.isEdit,"customer-currency":e(t).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},ye=["onSubmit"],Ee={class:"flex"},be={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},we={class:"relative w-full lg:w-1/2"},Le={__name:"EstimateCreate",setup(s){const t=x(),v=Y(),l=A(),$=O(),{t:r}=J(),u="newEstimate";let c=S(!1);const h=S(!1),m=S(["customer","company","customerCustom","estimate","estimateCustom"]);let k=K(),M=Q(),p=y(()=>t.isFetchingInitialSettings),P=y(()=>_.value?r("estimates.edit_estimate"):r("estimates.new_estimate")),_=y(()=>k.name==="estimates.edit");const F=y(()=>l.selectedCompanySettings.sales_tax_us_enabled==="YES"&&v.salesTaxUSEnabled),T={estimate_date:{required:f.withMessage(r("validation.required"),w)},estimate_number:{required:f.withMessage(r("validation.required"),w)},reference_number:{maxLength:f.withMessage(r("validation.price_maxlength"),W(255))},customer_id:{required:f.withMessage(r("validation.required"),w)},exchange_rate:{required:X(function(){return f.withMessage(r("validation.required"),w),t.showExchangeRate}),decimal:f.withMessage(r("validation.valid_exchange_rate"),Z)}},b=ee(T,y(()=>t.newEstimate),{$scope:u});te(()=>t.newEstimate.customer,i=>{i&&i.currency?t.newEstimate.selectedCurrency=i.currency:t.newEstimate.selectedCurrency=l.selectedCompanyCurrency}),t.resetCurrentEstimate(),$.resetCustomFields(),b.value.$reset,t.fetchEstimateInitialSettings(_.value);async function N(){if(b.value.$touch(),b.value.$invalid)return!1;c.value=!0;let i={...t.newEstimate,sub_total:t.getSubTotal,total:t.getTotal,tax:t.getTotalTax};const V=_.value?t.updateEstimate:t.addEstimate;try{let d=await V(i);d.data.data&&M.push(`/admin/estimates/${d.data.data.id}/view`)}catch(d){console.error(d)}c.value=!1}return(i,V)=>{const d=o("BaseBreadcrumbItem"),U=o("BaseBreadcrumb"),q=o("BaseButton"),D=o("router-link"),G=o("BaseIcon"),H=o("BasePageHeader"),R=o("BaseScrollPane"),j=o("BasePage");return g(),L(ne,null,[a(oe),a(le),a(_e),e(F)&&(!e(p)||e(k).query.customer)?(g(),E(re,{key:0,store:e(t),"store-prop":"newEstimate","is-edit":e(_),customer:e(t).newEstimate.customer},null,8,["store","is-edit","customer"])):C("",!0),a(j,{class:"relative estimate-create-page"},{default:n(()=>[B("form",{onSubmit:ie(N,["prevent"])},[a(H,{title:e(P)},{actions:n(()=>[i.$route.name==="estimates.edit"?(g(),E(D,{key:0,to:`/estimates/pdf/${e(t).newEstimate.unique_hash}`,target:"_blank"},{default:n(()=>[a(q,{class:"mr-3",variant:"primary-outline",type:"button"},{default:n(()=>[B("span",Ee,I(i.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):C("",!0),a(q,{loading:e(c),disabled:e(c),"content-loading":e(p),variant:"primary",type:"submit"},{left:n(z=>[e(c)?C("",!0):(g(),E(G,{key:0,class:ae(z.class),name:"SaveIcon"},null,8,["class"]))]),default:n(()=>[se(" "+I(i.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:n(()=>[a(U,null,{default:n(()=>[a(d,{title:i.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),a(d,{title:i.$tc("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),i.$route.name==="estimates.edit"?(g(),E(d,{key:0,title:i.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(g(),E(d,{key:1,title:i.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),a(ve,{v:e(b),"is-loading":e(p),"is-edit":e(_)},null,8,["v","is-loading","is-edit"]),a(R,null,{default:n(()=>[a(me,{currency:e(t).newEstimate.selectedCurrency,"is-loading":e(p),"item-validation-scope":u,store:e(t),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),B("div",be,[B("div",we,[a(de,{store:e(t),"store-prop":"newEstimate",fields:m.value,type:"Estimate"},null,8,["store","fields"]),a(ge,{type:"Estimate","is-edit":e(_),"is-loading":e(p),store:e(t),"store-prop":"newEstimate","custom-field-scope":u,class:"mb-6"},null,8,["is-edit","is-loading","store"]),a(ue,{store:e(t),"component-name":"EstimateTemplate","store-prop":"newEstimate","is-mark-as-default":h.value},null,8,["store","is-mark-as-default"])]),a(ce,{currency:e(t).newEstimate.selectedCurrency,"is-loading":e(p),store:e(t),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],40,ye)]),_:1})],64)}}};export{Le as default};
