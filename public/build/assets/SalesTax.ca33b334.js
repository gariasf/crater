import{ax as Z,I as X,N as ae,d as Y,K as me,a4 as oe,m as J,e as B,E as se,r as y,o as l,c as $,b as n,t as h,a as o,a5 as ve,g as a,i as c,z as A,k as j,h as L,H as ee,at as pe,M as $e,P as W,q as U,s as G,aG as ue,ak as te,aI as we,x as ne,y as K,F as H,j as Q,R as re,aJ as Be,aq as ye,a7 as Ie,aK as Se,n as R,O as ke,aL as Pe,aM as Te,ac as Ce,u as Me,L as De,f as fe,w as xe,J as Ve}from"./main.85eae20a.js";import{D as je,d as qe}from"./DragIcon.b05ab1c2.js";import{_ as Ee}from"./SelectNotePopup.bd13c791.js";const Ae={class:"flex items-center justify-between mb-3"},Le={class:"flex items-center text-base",style:{flex:"4"}},Oe={class:"pr-2 mb-0",align:"right"},Ue={class:"absolute left-3.5"},ze={class:"ml-2 text-sm leading-none text-primary-400 cursor-pointer"},Ne=n("br",null,null,-1),Fe={class:"text-sm text-right",style:{flex:"3"}},Ge={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},Re={__name:"CreateItemRowTax",props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(s,{emit:t}){const e=s,r=Z(),w=X(),b=ae(),I=Y(null),f=me({...e.taxData});oe("utils");const{t:D}=J(),p=B(()=>r.taxTypes.map(u=>({...u})).map(u=>(e.taxes.find(x=>x.tax_type_id===u.id)?u.disabled=!0:u.disabled=!1,u))),q=B(()=>f.compound_tax&&e.total?(e.total+e.totalTax)*f.percent/100:e.total&&f.percent?e.total*f.percent/100:0);se(()=>e.total,()=>{P()}),se(()=>e.totalTax,()=>{P()}),e.taxData.tax_type_id>0&&(I.value=r.taxTypes.find(m=>m.id===e.taxData.tax_type_id)),P();function V(m){f.percent=m.percent,f.tax_type_id=m.id,f.compound_tax=m.compound_tax,f.name=m.name,P()}function P(){f.tax_type_id!==0&&t("update",{index:e.index,item:{...f,amount:q.value}})}function d(){let m={itemIndex:e.itemIndex,taxIndex:e.index};w.openModal({title:D("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:m,size:"sm"})}function i(m){e.store.$patch(u=>{u[e.storeProp].items[e.itemIndex].taxes.splice(m,1)})}return(m,u)=>{const k=y("BaseIcon"),x=y("BaseMultiselect"),M=y("BaseFormatMoney");return l(),$("div",Ae,[n("div",Le,[n("label",Oe,h(m.$t("invoices.item.tax")),1),o(x,{modelValue:I.value,"onUpdate:modelValue":[u[0]||(u[0]=T=>I.value=T),u[1]||(u[1]=T=>V(T))],"value-prop":"id",options:a(p),placeholder:m.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},ve({singlelabel:c(({value:T})=>[n("div",Ue,h(T.name)+" - "+h(T.percent)+" % ",1)]),option:c(({option:T})=>[A(h(T.name)+" - "+h(T.percent)+" % ",1)]),_:2},[a(b).hasAbilities(s.ability)?{name:"action",fn:c(()=>[n("button",{type:"button",class:"flex items-center justify-center w-full px-2 cursor-pointer py-2 bg-gray-200 border-none outline-none",onClick:d},[o(k,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),n("label",ze,h(m.$t("invoices.add_new_tax")),1)])]),key:"0"}:void 0]),1032,["modelValue","options","placeholder"]),Ne]),n("div",Fe,[o(M,{amount:a(q),currency:s.currency},null,8,["amount","currency"])]),n("div",Ge,[s.taxes.length&&s.index!==s.taxes.length-1?(l(),j(k,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:u[2]||(u[2]=T=>i(s.index))})):L("",!0)])])}}},Ye={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},We={colspan:"5",class:"p-0 text-left align-top"},Xe={class:"w-full"},Je=n("col",{style:{width:"40%","min-width":"280px"}},null,-1),Ke=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),He=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),Qe={key:0,style:{width:"15%","min-width":"160px"}},Ze=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),et={class:"px-5 py-4 text-left align-top"},tt={class:"flex justify-start"},st={class:"flex items-center justify-center w-5 h-5 mt-2 text-gray-300 cursor-move handle mr-2"},at={class:"px-5 py-4 text-right align-top"},ot={class:"px-5 py-4 text-left align-top"},nt={class:"flex flex-col"},rt={class:"flex-auto flex-fill bd-highlight"},lt={class:"relative w-full"},it={key:0,class:"px-5 py-4 text-left align-top"},dt={class:"flex flex-col"},ct={class:"flex",style:{width:"120px"},role:"group"},ut={class:"flex items-center"},mt={class:"px-5 py-4 text-right align-top"},pt={class:"flex items-center justify-end text-sm"},yt={class:"flex items-center justify-center w-6 h-10 mx-2"},ft={key:0},xt=n("td",{class:"px-5 py-4 text-left align-top"},null,-1),_t={colspan:"4",class:"px-5 py-4 text-left align-top"},gt={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(s,{emit:t}){const e=s,r=ee(),w=pe();$e();const{t:b}=J(),I=B({get:()=>e.itemData.quantity,set:g=>{E("quantity",parseFloat(g))}}),f=B({get:()=>{const g=e.itemData.price;return parseFloat(g)>0?g/100:g},set:g=>{if(parseFloat(g)>0){let S=Math.round(g*100);E("price",S)}else E("price",g)}}),D=B(()=>e.itemData.price*e.itemData.quantity),p=B({get:()=>e.itemData.discount,set:g=>{e.itemData.discount_type==="percentage"?E("discount_val",D.value*g/100):E("discount_val",Math.round(g*100)),E("discount",g)}}),q=B(()=>D.value-e.itemData.discount_val),V=B(()=>e.currency?e.currency:r.selectedCompanyCurrency),P=B(()=>e.store[e.storeProp].items.length!=1),d=B(()=>Math.round(W.exports.sumBy(e.itemData.taxes,function(g){return g.compound_tax?0:g.amount}))),i=B(()=>Math.round(W.exports.sumBy(e.itemData.taxes,function(g){return g.compound_tax?g.amount:0}))),m=B(()=>d.value+i.value),u={name:{required:U.withMessage(b("validation.required"),G)},quantity:{required:U.withMessage(b("validation.required"),G),minValue:U.withMessage(b("validation.qty_must_greater_than_zero"),ue(0)),maxLength:U.withMessage(b("validation.amount_maxlength"),te(20))},price:{required:U.withMessage(b("validation.required"),G),minValue:U.withMessage(b("validation.number_length_minvalue"),ue(1)),maxLength:U.withMessage(b("validation.price_maxlength"),te(20))},discount_val:{between:U.withMessage(b("validation.discount_maxlength"),we(0,B(()=>D.value)))},description:{maxLength:U.withMessage(b("validation.notes_maxlength"),te(65e3))}},k=ne(u,B(()=>e.store[e.storeProp].items[e.index]),{$scope:e.itemValidationScope});function x(g){e.store.$patch(O=>{O[e.storeProp].items[e.index].taxes[g.index]=g.item});let S=e.itemData.taxes[e.itemData.taxes.length-1];(S==null?void 0:S.tax_type_id)!==0&&e.store.$patch(O=>{O[e.storeProp].items[e.index].taxes.push({...Be,id:ye.raw()})}),C()}function M(g){E("name",g)}function T(g){e.store.$patch(S=>{if(S[e.storeProp].items[e.index].name=g.name,S[e.storeProp].items[e.index].price=g.price,S[e.storeProp].items[e.index].item_id=g.id,S[e.storeProp].items[e.index].description=g.description,g.unit&&(S[e.storeProp].items[e.index].unit_name=g.unit.name),e.store[e.storeProp].tax_per_item==="YES"&&g.taxes){let O=0;g.taxes.forEach(F=>{x({index:O,item:{...F}}),O++})}S[e.storeProp].exchange_rate&&(S[e.storeProp].items[e.index].price/=S[e.storeProp].exchange_rate)}),w.fetchItems(),C()}function _(){e.itemData.discount_type!=="fixed"&&(E("discount_val",Math.round(e.itemData.discount*100)),E("discount_type","fixed"))}function v(){e.itemData.discount_type!=="percentage"&&(E("discount_val",D.value*e.itemData.discount/100),E("discount_type","percentage"))}function C(){var O,F;let g=(F=(O=e.store[e.storeProp])==null?void 0:O.items[e.index])==null?void 0:F.taxes;g||(g=[]);let S={...e.store[e.storeProp].items[e.index],index:e.index,total:q.value,sub_total:D.value,totalSimpleTax:d.value,totalCompoundTax:i.value,totalTax:m.value,tax:m.value,taxes:[...g]};e.store.updateItem(S)}function E(g,S){e.store.$patch(O=>{O[e.storeProp].items[e.index][g]=S}),C()}return(g,S)=>{const O=y("BaseItemSelect"),F=y("BaseInput"),z=y("BaseMoney"),le=y("BaseIcon"),_e=y("BaseButton"),ie=y("BaseDropdownItem"),ge=y("BaseDropdown"),de=y("BaseContentPlaceholdersText"),ce=y("BaseContentPlaceholders"),he=y("BaseFormatMoney");return l(),$("tr",Ye,[n("td",We,[n("table",Xe,[n("colgroup",null,[Je,Ke,He,s.store[s.storeProp].discount_per_item==="YES"?(l(),$("col",Qe)):L("",!0),Ze]),n("tbody",null,[n("tr",null,[n("td",et,[n("div",tt,[n("div",st,[o(je)]),o(O,{type:"Invoice",item:s.itemData,invalid:a(k).name.$error,"invalid-description":a(k).description.$error,taxes:s.itemData.taxes,index:s.index,"store-prop":s.storeProp,store:s.store,onSearch:M,onSelect:T},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),n("td",at,[o(F,{modelValue:a(I),"onUpdate:modelValue":S[0]||(S[0]=N=>K(I)?I.value=N:null),invalid:a(k).quantity.$error,"content-loading":s.loading,type:"number",small:"",min:"0",step:"any",onChange:S[1]||(S[1]=N=>C()),onInput:S[2]||(S[2]=N=>a(k).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),n("td",ot,[n("div",nt,[n("div",rt,[n("div",lt,[(l(),j(z,{key:a(V),modelValue:a(f),"onUpdate:modelValue":S[3]||(S[3]=N=>K(f)?f.value=N:null),invalid:a(k).price.$error,"content-loading":s.loading,currency:a(V)},null,8,["modelValue","invalid","content-loading","currency"]))])])])]),s.store[s.storeProp].discount_per_item==="YES"?(l(),$("td",it,[n("div",dt,[n("div",ct,[o(F,{modelValue:a(p),"onUpdate:modelValue":S[4]||(S[4]=N=>K(p)?p.value=N:null),invalid:a(k).discount_val.$error,"content-loading":s.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),o(ge,{position:"bottom-end"},{activator:c(()=>[o(_e,{"content-loading":s.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:c(()=>[n("span",ut,[A(h(s.itemData.discount_type=="fixed"?s.currency.symbol:"%")+" ",1),o(le,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1},8,["content-loading"])]),default:c(()=>[o(ie,{onClick:_},{default:c(()=>[A(h(g.$t("general.fixed")),1)]),_:1}),o(ie,{onClick:v},{default:c(()=>[A(h(g.$t("general.percentage")),1)]),_:1})]),_:1})])])])):L("",!0),n("td",mt,[n("div",pt,[n("span",null,[s.loading?(l(),j(ce,{key:0},{default:c(()=>[o(de,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),j(he,{key:1,amount:a(q),currency:a(V)},null,8,["amount","currency"]))]),n("div",yt,[a(P)?(l(),j(le,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:S[5]||(S[5]=N=>s.store.removeItem(s.index))})):L("",!0)])])])]),s.store[s.storeProp].tax_per_item==="YES"?(l(),$("tr",ft,[xt,n("td",_t,[s.loading?(l(),j(ce,{key:0},{default:c(()=>[o(de,{lines:1,class:"w-24 h-8 rounded-md border"})]),_:1})):(l(!0),$(H,{key:1},Q(s.itemData.taxes,(N,be)=>(l(),j(Re,{key:N.id,index:be,"item-index":s.index,"tax-data":N,taxes:s.itemData.taxes,"discounted-total":a(q),"total-tax":a(d),total:a(D),currency:s.currency,"update-items":C,ability:a(re).CREATE_INVOICE,store:s.store,"store-prop":s.storeProp,onUpdate:x},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop"]))),128))])])):L("",!0)])])])])}}},ht={class:"text-center item-table min-w-full"},bt=n("col",{style:{width:"40%","min-width":"280px"}},null,-1),vt=n("col",{style:{width:"10%","min-width":"120px"}},null,-1),$t=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),wt={key:0,style:{width:"15%","min-width":"160px"}},Bt=n("col",{style:{width:"15%","min-width":"120px"}},null,-1),It={class:"bg-white border border-gray-200 border-solid"},St={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},kt={key:1,class:"pl-7"},Pt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Tt={key:1},Ct={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Mt={key:1},Dt={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Vt={key:1},jt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},qt={key:1,class:"pr-10 column-heading"},Ns={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(s){const t=s,e=ee(),r=B(()=>t.currency?t.currency:e.selectedCompanyCurrency);return(w,b)=>{const I=y("BaseContentPlaceholdersText"),f=y("BaseContentPlaceholders"),D=y("BaseIcon");return l(),$(H,null,[n("table",ht,[n("colgroup",null,[bt,vt,$t,s.store[s.storeProp].discount_per_item==="YES"?(l(),$("col",wt)):L("",!0),Bt]),n("thead",It,[n("tr",null,[n("th",St,[s.isLoading?(l(),j(f,{key:0},{default:c(()=>[o(I,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),$("span",kt,h(w.$tc("items.item",2)),1))]),n("th",Pt,[s.isLoading?(l(),j(f,{key:0},{default:c(()=>[o(I,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),$("span",Tt,h(w.$t("invoices.item.quantity")),1))]),n("th",Ct,[s.isLoading?(l(),j(f,{key:0},{default:c(()=>[o(I,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),$("span",Mt,h(w.$t("invoices.item.price")),1))]),s.store[s.storeProp].discount_per_item==="YES"?(l(),$("th",Dt,[s.isLoading?(l(),j(f,{key:0},{default:c(()=>[o(I,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),$("span",Vt,h(w.$t("invoices.item.discount")),1))])):L("",!0),n("th",jt,[s.isLoading?(l(),j(f,{key:0},{default:c(()=>[o(I,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),$("span",qt,h(w.$t("invoices.item.amount")),1))])])]),o(a(qe),{modelValue:s.store[s.storeProp].items,"onUpdate:modelValue":b[0]||(b[0]=p=>s.store[s.storeProp].items=p),"item-key":"id",tag:"tbody",handle:".handle"},{item:c(({element:p,index:q})=>[(l(),j(gt,{key:p.id,index:q,"item-data":p,loading:s.isLoading,currency:a(r),"item-validation-scope":s.itemValidationScope,"invoice-items":s.store[s.storeProp].items,store:s.store,"store-prop":s.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),n("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:b[1]||(b[1]=(...p)=>s.store.addItem&&s.store.addItem(...p))},[o(D,{name:"PlusCircleIcon",class:"mr-2"}),A(" "+h(w.$t("general.add_new_item")),1)])],64)}}},Et={class:"flex items-center justify-between w-full mt-2 text-sm"},At={class:"font-semibold leading-5 text-gray-500 uppercase"},Lt={class:"flex items-center justify-center text-lg text-black"},Ot={__name:"CreateTotalTaxes",props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(s,{emit:t}){const e=s;oe("$utils");const r=B(()=>e.tax.compound_tax&&e.store.getSubtotalWithDiscount?Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*e.tax.percent/100):e.store.getSubtotalWithDiscount&&e.tax.percent?Math.round(e.store.getSubtotalWithDiscount*e.tax.percent/100):0);Ie(()=>{e.store.getSubtotalWithDiscount&&w(),e.store.getTotalSimpleTax&&w()});function w(){t("update",{...e.tax,amount:r.value})}return(b,I)=>{const f=y("BaseFormatMoney"),D=y("BaseIcon");return l(),$("div",Et,[n("label",At,h(s.tax.name)+" ("+h(s.tax.percent)+" %) ",1),n("label",Lt,[o(f,{amount:s.tax.amount,currency:s.currency},null,8,["amount","currency"]),o(D,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:I[0]||(I[0]=p=>b.$emit("remove",s.tax.id))})])])}}},Ut={class:"w-full mt-4 tax-select"},zt={class:"relative w-full max-w-md px-4"},Nt={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},Ft={class:"relative bg-white"},Gt={class:"relative p-4"},Rt={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},Yt=["onClick"],Wt={class:"flex justify-between px-2"},Xt={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},Jt={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},Kt={key:1,class:"flex justify-center p-5 text-gray-400"},Ht={class:"text-base text-gray-500 cursor-pointer"},Qt={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},Zt={__name:"SelectTaxPopup",props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(s,{emit:t}){const e=s,r=X(),w=Z(),b=ae(),{t:I}=J(),f=Y(null),D=B(()=>f.value?w.taxTypes.filter(function(P){return P.name.toLowerCase().indexOf(f.value.toLowerCase())!==-1}):w.taxTypes),p=B(()=>e.store[e.storeProp].taxes);function q(P,d){t("select:taxType",{...P}),d()}function V(){r.openModal({title:I("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:P=>t("select:taxType",P)})}return(P,d)=>{const i=y("BaseIcon"),m=y("BaseInput");return l(),$("div",Ut,[o(a(Te),{class:"relative"},{default:c(({isOpen:u})=>[o(a(Se),{class:R([u?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:c(()=>[o(i,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),A(" "+h(P.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),n("div",zt,[o(ke,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:c(()=>[o(a(Pe),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:c(({close:k})=>[n("div",Nt,[n("div",Ft,[n("div",Gt,[o(m,{modelValue:f.value,"onUpdate:modelValue":d[0]||(d[0]=x=>f.value=x),placeholder:P.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),a(D).length>0?(l(),$("div",Rt,[(l(!0),$(H,null,Q(a(D),(x,M)=>(l(),$("div",{key:M,class:R([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":a(p).find(T=>T.tax_type_id===x.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:T=>q(x,k)},[n("div",Wt,[n("label",Xt,h(x.name),1),n("label",Jt,h(x.percent)+" % ",1)])],10,Yt))),128))])):(l(),$("div",Kt,[n("label",Ht,h(P.$t("general.no_tax_found")),1)]))]),a(b).hasAbilities(a(re).CREATE_TAX_TYPE)?(l(),$("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:V},[o(i,{name:"CheckCircleIcon",class:"text-primary-400"}),n("label",Qt,h(P.$t("estimates.add_new_tax")),1)])):L("",!0)])]),_:1})]),_:1})])]),_:1})])}}},es={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},ts={class:"flex items-center justify-between w-full"},ss={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},as={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},os={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},ns={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},rs={key:0,class:"flex items-center justify-between w-full mt-2"},ls={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},is={key:3,class:"flex",style:{width:"140px"},role:"group"},ds={class:"flex items-center"},cs={key:1},us={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},ms={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},ps={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},Fs={__name:"CreateTotal",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(s){const t=s,e=Y(null);oe("$utils");const r=ee(),w=B({get:()=>t.store[t.storeProp].discount,set:d=>{t.store[t.storeProp].discount_type==="percentage"?t.store[t.storeProp].discount_val=Math.round(t.store.getSubTotal*d/100):t.store[t.storeProp].discount_val=Math.round(d*100),t.store[t.storeProp].discount=d}}),b=B({get:()=>t.store[t.storeProp].taxes,set:d=>{t.store.$patch(i=>{i[t.storeProp].taxes=d})}}),I=B(()=>{let d=[];return t.store[t.storeProp].items.forEach(i=>{i.taxes&&i.taxes.forEach(m=>{let u=d.find(k=>k.tax_type_id===m.tax_type_id);u?u.amount+=m.amount:m.tax_type_id&&d.push({tax_type_id:m.tax_type_id,amount:m.amount,percent:m.percent,name:m.name})})}),d}),f=B(()=>t.currency?t.currency:r.selectedCompanyCurrency);function D(){t.store[t.storeProp].discount_type!=="fixed"&&(t.store[t.storeProp].discount_val=Math.round(t.store[t.storeProp].discount*100),t.store[t.storeProp].discount_type="fixed")}function p(){t.store[t.storeProp].discount_type!=="percentage"&&(t.store[t.storeProp].discount_val=t.store.getSubTotal*t.store[t.storeProp].discount/100,t.store[t.storeProp].discount_type="percentage")}function q(d){let i=0;d.compound_tax&&t.store.getSubtotalWithDiscount?i=Math.round((t.store.getSubtotalWithDiscount+t.store.getTotalSimpleTax)*d.percent/100):t.store.getSubtotalWithDiscount&&d.percent&&(i=Math.round(t.store.getSubtotalWithDiscount*d.percent/100));let m={...re,id:ye.raw(),name:d.name,percent:d.percent,compound_tax:d.compound_tax,tax_type_id:d.id,amount:i};t.store.$patch(u=>{u[t.storeProp].taxes.push({...m})})}function V(d){const i=t.store[t.storeProp].taxes.find(m=>m.id===d.id);i&&Object.assign(i,{...d})}function P(d){const i=t.store[t.storeProp].taxes.findIndex(m=>m.id===d);t.store.$patch(m=>{m[t.storeProp].taxes.splice(i,1)})}return(d,i)=>{const m=y("BaseContentPlaceholdersText"),u=y("BaseContentPlaceholders"),k=y("BaseFormatMoney"),x=y("BaseInput"),M=y("BaseIcon"),T=y("BaseButton"),_=y("BaseDropdownItem"),v=y("BaseDropdown");return l(),$("div",es,[n("div",ts,[s.isLoading?(l(),j(u,{key:0},{default:c(()=>[o(m,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),$("label",ss,h(d.$t("estimates.sub_total")),1)),s.isLoading?(l(),j(u,{key:2},{default:c(()=>[o(m,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),$("label",as,[o(k,{amount:s.store.getSubTotal,currency:a(f)},null,8,["amount","currency"])]))]),(l(!0),$(H,null,Q(a(I),C=>(l(),$("div",{key:C.tax_type_id,class:"flex items-center justify-between w-full"},[s.isLoading?(l(),j(u,{key:0},{default:c(()=>[o(m,{lines:1,class:"w-16 h-5"})]),_:1})):s.store[s.storeProp].tax_per_item==="YES"?(l(),$("label",os,h(C.name)+" - "+h(C.percent)+"% ",1)):L("",!0),s.isLoading?(l(),j(u,{key:2},{default:c(()=>[o(m,{lines:1,class:"w-16 h-5"})]),_:1})):s.store[s.storeProp].tax_per_item==="YES"?(l(),$("label",ns,[o(k,{amount:C.amount,currency:a(f)},null,8,["amount","currency"])])):L("",!0)]))),128)),s.store[s.storeProp].discount_per_item==="NO"||s.store[s.storeProp].discount_per_item===null?(l(),$("div",rs,[s.isLoading?(l(),j(u,{key:0},{default:c(()=>[o(m,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),$("label",ls,h(d.$t("estimates.discount")),1)),s.isLoading?(l(),j(u,{key:2},{default:c(()=>[o(m,{lines:1,class:"w-24 h-8 rounded-md border"})]),_:1})):(l(),$("div",is,[o(x,{modelValue:a(w),"onUpdate:modelValue":i[0]||(i[0]=C=>K(w)?w.value=C:null),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),o(v,{position:"bottom-end"},{activator:c(()=>[o(T,{class:"rounded-tr-md rounded-br-md p-2 rounded-none",type:"button",variant:"white"},{default:c(()=>[n("span",ds,[A(h(s.store[s.storeProp].discount_type=="fixed"?a(f).symbol:"%")+" ",1),o(M,{name:"ChevronDownIcon",class:"w-4 h-4 text-gray-500 ml-1"})])]),_:1})]),default:c(()=>[o(_,{onClick:D},{default:c(()=>[A(h(d.$t("general.fixed")),1)]),_:1}),o(_,{onClick:p},{default:c(()=>[A(h(d.$t("general.percentage")),1)]),_:1})]),_:1})]))])):L("",!0),s.store[s.storeProp].tax_per_item==="NO"||s.store[s.storeProp].tax_per_item===null?(l(),$("div",cs,[(l(!0),$(H,null,Q(a(b),(C,E)=>(l(),j(Ot,{key:C.id,index:E,tax:C,taxes:a(b),currency:s.currency,store:s.store,onRemove:P,onUpdate:V},null,8,["index","tax","taxes","currency","store"]))),128))])):L("",!0),s.store[s.storeProp].tax_per_item==="NO"||s.store[s.storeProp].tax_per_item===null?(l(),$("div",{key:2,ref_key:"taxModal",ref:e,class:"float-right pt-2 pb-4"},[o(Zt,{"store-prop":s.storeProp,store:s.store,type:s.taxPopupType,"onSelect:taxType":q},null,8,["store-prop","store","type"])],512)):L("",!0),n("div",us,[s.isLoading?(l(),j(u,{key:0},{default:c(()=>[o(m,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),$("label",ms,h(d.$t("estimates.total"))+" "+h(d.$t("estimates.amount"))+":",1)),s.isLoading?(l(),j(u,{key:2},{default:c(()=>[o(m,{lines:1,class:"w-16 h-5"})]),_:1})):(l(),$("label",ps,[o(k,{amount:s.store.getTotal,currency:a(f)},null,8,["amount","currency"])]))])])}}},ys={class:"flex text-gray-800 font-medium text-sm mb-2"},fs=n("span",{class:"text-sm text-red-500"}," *",-1),Gs={__name:"SelectTemplateButton",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(s){const t=s,e=X(),{t:r}=J();function w(){let b="";t.storeProp=="newEstimate"?b=r("estimates.mark_as_default_estimate_template_description"):t.storeProp=="newInvoice"&&(b=r("invoices.mark_as_default_invoice_template_description")),e.openModal({title:r("general.choose_template"),componentName:"SelectTemplate",data:{templates:t.store.templates,store:t.store,storeProp:t.storeProp,isMarkAsDefault:t.isMarkAsDefault,markAsDefaultDescription:b}})}return(b,I)=>{const f=y("BaseIcon"),D=y("BaseButton");return l(),$("div",null,[n("label",ys,[A(h(b.$t("general.select_template"))+" ",1),fs]),o(D,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:w},{right:c(p=>[o(f,{name:"PencilIcon",class:R(p.class)},null,8,["class"])]),default:c(()=>[A(" "+h(s.store[s.storeProp].template_name),1)]),_:1})])}}},xs={class:"mb-6"},_s={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},gs={class:"text-gray-800 font-medium mb-4 text-sm"},Rs={__name:"CreateNotesField",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(s){const t=s;function e(r){t.store[t.storeProp].notes=""+r.notes}return(r,w)=>{const b=y("BaseCustomInput");return l(),$("div",xs,[n("div",_s,[o(Ee,{type:s.type,onSelect:e},null,8,["type"])]),n("label",gs,h(r.$t("invoices.notes")),1),o(b,{modelValue:s.store[s.storeProp].notes,"onUpdate:modelValue":w[0]||(w[0]=I=>s.store[s.storeProp].notes=I),"content-loading":s.store.isFetchingInitialSettings,fields:s.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},hs={class:"flex justify-between w-full"},bs={class:"px-8 py-8 sm:p-6"},vs={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},$s=["onClick"],ws=["src","alt"],Bs=["alt","src"],Is={key:1,class:"z-0 flex ml-3 pt-5"},Ss={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ys={__name:"SelectTemplateModal",setup(s){const t=X(),e=ae(),r=Y(""),w=B(()=>t.active&&t.componentName==="SelectTemplate"),b=B(()=>t.title);function I(){t.data.store[t.data.storeProp].template_name?r.value=t.data.store[t.data.storeProp].template_name:r.value=t.data.templates[0]}async function f(){await t.data.store.setTemplate(r.value),!t.data.store.isEdit&&t.data.isMarkAsDefault&&(t.data.storeProp=="newEstimate"?await e.updateUserSettings({settings:{default_estimate_template:r.value}}):t.data.storeProp=="newInvoice"&&await e.updateUserSettings({settings:{default_invoice_template:r.value}})),p()}function D(){return new URL("/build/img/tick.png",self.location)}function p(){t.closeModal(),setTimeout(()=>{t.$reset()},300)}return(q,V)=>{const P=y("BaseIcon"),d=y("BaseCheckbox"),i=y("BaseButton"),m=y("BaseModal");return l(),j(m,{show:a(w),onClose:p,onOpen:I},{header:c(()=>[n("div",hs,[A(h(a(b))+" ",1),o(P,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:p})])]),default:c(()=>[n("div",bs,[a(t).data?(l(),$("div",vs,[(l(!0),$(H,null,Q(a(t).data.templates,(u,k)=>(l(),$("div",{key:k,class:R([{"border border-solid border-primary-500":r.value===u.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:x=>r.value=u.name},[n("img",{src:u.path,alt:u.name,class:"w-full min-h-[100px]"},null,8,ws),r.value===u.name?(l(),$("img",{key:0,alt:u.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:D()},null,8,Bs)):L("",!0),n("span",{class:R(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":r.value===u.name,"text-gray-600":r.value!=u.name}])},h(u.name),3)],10,$s))),128))])):L("",!0),a(t).data.store.isEdit?L("",!0):(l(),$("div",Is,[o(d,{modelValue:a(t).data.isMarkAsDefault,"onUpdate:modelValue":V[0]||(V[0]=u=>a(t).data.isMarkAsDefault=u),"set-initial-value":!1,variant:"primary",label:q.$t("general.mark_as_default"),description:a(t).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),n("div",Ss,[o(i,{class:"mr-3",variant:"primary-outline",onClick:p},{default:c(()=>[A(h(q.$t("general.cancel")),1)]),_:1}),o(i,{variant:"primary",onClick:V[1]||(V[1]=u=>f())},{left:c(u=>[o(P,{name:"SaveIcon",class:R(u.class)},null,8,["class"])]),default:c(()=>[A(" "+h(q.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},ks={class:"flex justify-between w-full"},Ps={class:"item-modal"},Ts=["onSubmit"],Cs={class:"px-8 py-8 sm:p-6"},Ms={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ws={__name:"ItemModal",emits:["newItem"],setup(s,{emit:t}){const e=X(),r=pe(),w=ee(),b=Z();Ce(),Me();const{t:I}=J(),f=Y(!1),D=Y(w.selectedCompanySettings.tax_per_item),p=B(()=>e.active&&e.componentName==="ItemModal"),q=B({get:()=>r.currentItem.price/100,set:x=>{r.currentItem.price=Math.round(x*100)}}),V=B({get:()=>r.currentItem.taxes.map(x=>{if(x)return{...x,tax_type_id:x.id,tax_name:x.name+" ("+x.percent+"%)"}}),set:x=>{r.$patch(M=>{M.currentItem.taxes=x})}}),P=B(()=>D.value==="YES"),d={name:{required:U.withMessage(I("validation.required"),G),minLength:U.withMessage(I("validation.name_min_length",{count:3}),De(3))},description:{maxLength:U.withMessage(I("validation.description_maxlength",{count:255}),te(255))}},i=ne(d,B(()=>r.currentItem)),m=B(()=>b.taxTypes.map(x=>({...x,tax_name:x.name+" ("+x.percent+"%)"})));fe(()=>{i.value.$reset(),r.fetchItemUnits({limit:"all"})});async function u(){if(i.value.$touch(),i.value.$invalid)return!0;let x={...r.currentItem,taxes:r.currentItem.taxes.map(T=>({tax_type_id:T.id,amount:q.value*T.percent/100,percent:T.percent,name:T.name,collective_tax:0}))};f.value=!0,await(r.isEdit?r.updateItem:r.addItem)(x).then(T=>{f.value=!1,T.data.data&&e.data&&e.refreshData(T.data.data),k()})}function k(){e.closeModal(),setTimeout(()=>{r.resetCurrentItem(),e.$reset(),i.value.$reset()},300)}return(x,M)=>{const T=y("BaseIcon"),_=y("BaseInput"),v=y("BaseInputGroup"),C=y("BaseMoney"),E=y("BaseMultiselect"),g=y("BaseTextarea"),S=y("BaseInputGrid"),O=y("BaseButton"),F=y("BaseModal");return l(),j(F,{show:a(p),onClose:k},{header:c(()=>[n("div",ks,[A(h(a(e).title)+" ",1),o(T,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:k})])]),default:c(()=>[n("div",Ps,[n("form",{action:"",onSubmit:xe(u,["prevent"])},[n("div",Cs,[o(S,{layout:"one-column"},{default:c(()=>[o(v,{label:x.$t("items.name"),required:"",error:a(i).name.$error&&a(i).name.$errors[0].$message},{default:c(()=>[o(_,{modelValue:a(r).currentItem.name,"onUpdate:modelValue":M[0]||(M[0]=z=>a(r).currentItem.name=z),type:"text",invalid:a(i).name.$error,onInput:M[1]||(M[1]=z=>a(i).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),o(v,{label:x.$t("items.price")},{default:c(()=>[(l(),j(C,{key:a(w).selectedCompanyCurrency,modelValue:a(q),"onUpdate:modelValue":M[2]||(M[2]=z=>K(q)?q.value=z:null),currency:a(w).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"]))]),_:1},8,["label"]),o(v,{label:x.$t("items.unit")},{default:c(()=>[o(E,{modelValue:a(r).currentItem.unit_id,"onUpdate:modelValue":M[3]||(M[3]=z=>a(r).currentItem.unit_id=z),label:"name",options:a(r).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:x.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),a(P)?(l(),j(v,{key:0,label:x.$t("items.taxes")},{default:c(()=>[o(E,{modelValue:a(V),"onUpdate:modelValue":M[4]||(M[4]=z=>K(V)?V.value=z:null),options:a(m),mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):L("",!0),o(v,{label:x.$t("items.description"),error:a(i).description.$error&&a(i).description.$errors[0].$message},{default:c(()=>[o(g,{modelValue:a(r).currentItem.description,"onUpdate:modelValue":M[5]||(M[5]=z=>a(r).currentItem.description=z),rows:"4",cols:"50",invalid:a(i).description.$error,onInput:M[6]||(M[6]=z=>a(i).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),n("div",Ms,[o(O,{class:"mr-3",variant:"primary-outline",type:"button",onClick:k},{default:c(()=>[A(h(x.$t("general.cancel")),1)]),_:1}),o(O,{loading:f.value,disabled:f.value,variant:"primary",type:"submit"},{left:c(z=>[o(T,{name:"SaveIcon",class:R(z.class)},null,8,["class"])]),default:c(()=>[A(" "+h(a(r).isEdit?x.$t("general.update"):x.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,Ts)])]),_:1},8,["show"])}}},Ds={class:"flex justify-between w-full"},Vs={class:"flex flex-col"},js={class:"text-sm text-gray-500 mt-1"},qs=["onSubmit"],Es={class:"p-4 sm:p-6"},As={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Ls={__name:"TaxationAddressModal",emits:["addTax"],setup(s,{emit:t}){const e=X();Ve();const r=me({state:"",city:"",address_street_1:"",zip:""}),w=Y(!1),b=Z(),{t:I}=J(),f=B(()=>e.active&&e.componentName==="TaxationAddressModal"),D=B(()=>({state:{required:U.withMessage(I("validation.required"),G)},city:{required:U.withMessage(I("validation.required"),G)},address_street_1:{required:U.withMessage(I("validation.required"),G)},zip:{required:U.withMessage(I("validation.required"),G)}})),p=ne(D,B(()=>r));async function q(){if(p.value.$touch(),p.value.$invalid)return!0;let d={address:r};e.id&&(d.customer_id=e.id),r.address_street_1=r.address_street_1.replace(/(\r\n|\n|\r)/gm,""),w.value=!0,await b.fetchSalesTax(d).then(i=>{w.value=!1,t("addTax",i.data.data),P()}).catch(i=>{w.value=!1})}function V(){var d,i,m,u;r.state=(d=e==null?void 0:e.data)==null?void 0:d.state,r.city=(i=e==null?void 0:e.data)==null?void 0:i.city,r.address_street_1=(m=e==null?void 0:e.data)==null?void 0:m.address_street_1,r.zip=(u=e==null?void 0:e.data)==null?void 0:u.zip}function P(){e.closeModal()}return(d,i)=>{const m=y("BaseIcon"),u=y("BaseInput"),k=y("BaseInputGroup"),x=y("BaseTextarea"),M=y("BaseInputGrid"),T=y("BaseButton"),_=y("BaseModal");return l(),j(_,{show:a(f),onClose:P,onOpen:V},{header:c(()=>[n("div",Ds,[n("div",Vs,[A(h(a(e).title)+" ",1),n("p",js,h(a(e).content),1)]),o(m,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:P})])]),default:c(()=>[n("form",{onSubmit:xe(q,["prevent"])},[n("div",Es,[o(M,{layout:"one-column"},{default:c(()=>[o(k,{required:"",error:a(p).state.$error&&a(p).state.$errors[0].$message,label:d.$t("customers.state")},{default:c(()=>[o(u,{modelValue:r.state,"onUpdate:modelValue":i[0]||(i[0]=v=>r.state=v),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:a(p).state.$error,onInput:i[1]||(i[1]=v=>a(p).state.$touch()),placeholder:d.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),o(k,{required:"",error:a(p).city.$error&&a(p).city.$errors[0].$message,label:d.$t("customers.city")},{default:c(()=>[o(u,{modelValue:r.city,"onUpdate:modelValue":i[2]||(i[2]=v=>r.city=v),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:a(p).city.$error,onInput:i[3]||(i[3]=v=>a(p).city.$touch()),placeholder:d.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),o(k,{required:"",error:a(p).address_street_1.$error&&a(p).address_street_1.$errors[0].$message,label:d.$t("customers.address")},{default:c(()=>[o(x,{modelValue:r.address_street_1,"onUpdate:modelValue":i[4]||(i[4]=v=>r.address_street_1=v),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:a(p).address_street_1.$error,onInput:i[5]||(i[5]=v=>a(p).address_street_1.$touch()),placeholder:d.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),o(k,{required:"",error:a(p).zip.$error&&a(p).zip.$errors[0].$message,label:d.$t("customers.zip_code")},{default:c(()=>[o(u,{modelValue:r.zip,"onUpdate:modelValue":i[6]||(i[6]=v=>r.zip=v),invalid:a(p).zip.$error,onInput:i[7]||(i[7]=v=>a(p).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:d.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),n("div",As,[o(T,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:P},{default:c(()=>[A(h(d.$t("general.cancel")),1)]),_:1}),o(T,{loading:w.value,variant:"primary",type:"submit"},{left:c(v=>[w.value?L("",!0):(l(),j(m,{key:0,name:"SaveIcon",class:R(v.class)},null,8,["class"]))]),default:c(()=>[A(" "+h(d.$t("general.save")),1)]),_:1},8,["loading"])])],40,qs)]),_:1},8,["show"])}}},Xs={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(s){const t=s,e="Sales Tax",r="MODULE",w=X(),b=ee(),I=Z(),{t:f}=J(),D=Y(!1),p=B(()=>t.isEdit?t.store[t.storeProp].sales_tax_address_type==="billing":b.selectedCompanySettings.sales_tax_address_type==="billing"),q=B(()=>b.selectedCompanySettings.sales_tax_us_enabled==="YES"),V=B(()=>t.isEdit?t.store[t.storeProp].sales_tax_type==="customer_level":b.selectedCompanySettings.sales_tax_type==="customer_level"),P=B(()=>t.isEdit?t.store[t.storeProp].sales_tax_type==="company_level":b.selectedCompanySettings.sales_tax_type==="company_level"),d=B(()=>{if(V.value&&i.value){let _=p.value?t.customer.billing:t.customer.shipping;return{address:W.exports.pick(_,["address_street_1","city","state","zip"]),customer_id:t.customer.id}}else if(P.value&&i.value)return{address:W.exports.pick(address,["address_street_1","city","state","zip"])}}),i=B(()=>{var _,v;if(V.value){let C=p.value?(_=t.customer)==null?void 0:_.billing:(v=t.customer)==null?void 0:v.shipping;return m(C)}else if(P.value)return m(b.selectedCompany.address);return!1});se(()=>t.customer,(_,v)=>{if(_&&v&&V.value){u(_,v);return}!i.value&&V.value&&_?setTimeout(()=>{k()},500):V.value&&_?x():V.value&&!_&&T()}),fe(()=>{P.value&&(i.value?x():k())});function m(_){return _?_.address_street_1&&_.city&&_.state&&_.zip:!1}function u(_,v){const C=p.value?_.billing:_.shipping,E=p.value?v.billing:v.shipping,g=W.exports.pick(C,["address_street_1","city","state","zip"]),S=W.exports.pick(E,["address_street_1","city","state","zip"]);W.exports.isEqual(g,S)||x()}function k(){var C,E;if(!q.value)return;let _=null,v="";V.value?p.value?(_=(C=t.customer)==null?void 0:C.billing,v=f("settings.taxations.add_billing_address")):(_=(E=t.customer)==null?void 0:E.shipping,v=f("settings.taxations.add_shipping_address")):(_=b.selectedCompany.address,v=f("settings.taxations.add_company_address")),w.openModal({title:v,content:f("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:_,id:V.value?t.customer.id:""})}async function x(){!q.value||(D.value=!0,await I.fetchSalesTax(d.value).then(_=>{M(_.data.data),D.value=!1}).catch(_=>{_.response.data.error&&setTimeout(()=>{k()},500),D.value=!1}))}function M(_){_.tax_type_id=_.id;const v=t.store[t.storeProp].taxes.findIndex(C=>C.name===e&&C.type===r);v>-1?Object.assign(t.store[t.storeProp].taxes[v],_):t.store[t.storeProp].taxes.push(_)}function T(){const _=t.store[t.storeProp].taxes.findIndex(C=>C.name===e&&C.type===r);_>-1&&t.store[t.storeProp].taxes.splice(_,1);let v=I.taxTypes.findIndex(C=>C.name===e&&C.type===r);v>-1&&I.taxTypes.splice(v,1)}return(_,v)=>(l(),j(Ls,{onAddTax:M}))}};export{Ys as _,Ws as a,Xs as b,Ns as c,Rs as d,Gs as e,Fs as f};
